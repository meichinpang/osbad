<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="API Reference" href="autoapi/index.html" /><link rel="prev" title="Models Guide" href="models.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>Example: Benchmarking Isolation Forest with Probabilistic Outliers Prediction - osbad 1.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">osbad 1.2.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">osbad 1.2.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="dataset.html">Datasets Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Datasets Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="severson.html">MIT/Stanford Data-driven Prediction of Battery Cycle Life Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="tohoku.html">Tohoku Dataset</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="models.html">Models Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Models Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Example: Benchmarking Isolation Forest with Probabilistic Outliers Prediction</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="autoapi/osbad/index.html">osbad</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of osbad</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/config/index.html">osbad.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/database/index.html">osbad.database</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/hyperparam/index.html">osbad.hyperparam</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/model/index.html">osbad.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/modval/index.html">osbad.modval</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/scaler/index.html">osbad.scaler</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/stats/index.html">osbad.stats</a></li>
<li class="toctree-l3"><a class="reference internal" href="autoapi/osbad/viz/index.html">osbad.viz</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/iforest_example.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="example-benchmarking-isolation-forest-with-probabilistic-outliers-prediction">
<h1>Example: Benchmarking Isolation Forest with Probabilistic Outliers Prediction<a class="headerlink" href="#example-benchmarking-isolation-forest-with-probabilistic-outliers-prediction" title="Link to this heading">¶</a></h1>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Python 3.12 (recommended)</p></li>
<li><p>Files on disk:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">database/train_dataset_severson.db</span></code> (benchmark labels per cycle)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">database/train_features_severson.db</span></code> (engineered features per cycle)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PIPELINE_OUTPUT_DIR/hyperparams_iforest.csv</span></code> (An example of tuned
hyperparameters per cell for Isolation Forest)</p></li>
</ul>
</li>
<li><p>(Optional) LaTeX installation if you want Matplotlib to render text with
LaTeX:</p>
<ul>
<li><p>A TeX distribution (e.g., TeX Live/MacTeX/MiKTeX), dvipng, and fonts
like cm-super.</p></li>
<li><p>Don’t have LaTeX installed? Either install it, or set
<code class="docutils literal notranslate"><span class="pre">rcParams[&quot;text.usetex&quot;]</span> <span class="pre">=</span> <span class="pre">False</span></code>.</p></li>
</ul>
</li>
</ul>
<p>Before running the example in the <code class="docutils literal notranslate"><span class="pre">quick_start_tutorials</span></code> section, please
evaluate whether the global directory path specified in <code class="docutils literal notranslate"><span class="pre">src/osbad/config.py</span></code>
needs to be updated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modify this global directory path if needed</span>
<span class="n">PIPELINE_OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;artifacts_output_dir&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following example of running a model with probabilistic outlier prediction
is also provided as a notebook in
<code class="docutils literal notranslate"><span class="pre">quick_start_tutorials/02_run_model_tutorial.ipynb</span></code>.</p>
</section>
<section id="step-1-load-libraries">
<h2>Step-1: Load libraries<a class="headerlink" href="#step-1-load-libraries" title="Link to this heading">¶</a></h2>
<p>Import the libraries into your local development environment, including the
<code class="docutils literal notranslate"><span class="pre">osbad</span></code> library for benchmarking anomaly detection.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Path</span></code> is used for robust, cross-platform file paths.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duckdb</span></code> is the embedded analytical database engine storing the dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fireducks.pandas</span> <span class="pre">as</span> <span class="pre">pd</span></code> gives you a pandas-compatible API;
you can usually treat it like import pandas as pd.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rcParams[&quot;text.usetex&quot;]</span> <span class="pre">=</span> <span class="pre">True</span></code> tells Matplotlib to render text via
LaTeX. If you don’t have LaTeX installed, flip this to False.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bconf</span></code>: project config utilities (e.g., where to write artifacts).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BenchDB</span></code>: a thin layer around DuckDB that provides convenience loaders.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ModelRunner</span></code>, <code class="docutils literal notranslate"><span class="pre">hp</span></code>, <code class="docutils literal notranslate"><span class="pre">modval</span></code>: modeling, hyperparameters, and
model validation helpers for benchmarking study in this project.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Base libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Database library</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span>

<span class="c1"># Data analysis libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fireducks.pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Custom osbad library for benchmarking anomaly detection</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">osbad.config</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">bconf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osbad.database</span><span class="w"> </span><span class="kn">import</span> <span class="n">BenchDB</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osbad.model</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelRunner</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">osbad.hyperparam</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">hp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">osbad.modval</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">modval</span>
</pre></div>
</div>
</section>
<section id="step-2-load-benchmarking-dataset">
<h2>Step-2: Load Benchmarking Dataset<a class="headerlink" href="#step-2-load-benchmarking-dataset" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Pick a specific cell based on the <code class="docutils literal notranslate"><span class="pre">cell_index</span></code>, which identifies the
experimental data corresponding to one unique cell.</p></li>
<li><p>Create an artifacts folder for that cell, where you can save figures,
tables, or model outputs related to this cell.</p></li>
<li><p>Initialize <code class="docutils literal notranslate"><span class="pre">BenchDB</span></code> for the selected cell and path to the DuckDB file:
<code class="docutils literal notranslate"><span class="pre">train_dataset_severson.db</span></code>.</p></li>
<li><p>Loads all data related to <code class="docutils literal notranslate"><span class="pre">selected_cell_label</span></code> from the training
partition.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the cell-ID from unique_cell_index_train</span>
<span class="n">selected_cell_label</span> <span class="o">=</span> <span class="s2">&quot;2017-05-12_5_4C-70per_3C_CH17&quot;</span>

<span class="c1"># Create a subfolder to store fig output</span>
<span class="c1"># corresponding to each cell-index</span>
<span class="n">selected_cell_artifacts_dir</span> <span class="o">=</span> <span class="n">bconf</span><span class="o">.</span><span class="n">artifacts_output_dir</span><span class="p">(</span>
    <span class="n">selected_cell_label</span><span class="p">)</span>

<span class="c1"># Path to the DuckDB file:</span>
<span class="c1"># &quot;train_dataset_severson.db&quot;</span>
<span class="n">db_filepath</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="o">.</span><span class="n">parent</span>
    <span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">,</span><span class="s2">&quot;train_dataset_severson.db&quot;</span><span class="p">))</span>

<span class="c1"># Import the BenchDB class</span>
<span class="c1"># Load only the dataset based on the selected cell</span>
<span class="n">benchdb</span> <span class="o">=</span> <span class="n">BenchDB</span><span class="p">(</span>
    <span class="n">db_filepath</span><span class="p">,</span>
    <span class="n">selected_cell_label</span><span class="p">)</span>

<span class="c1"># load the benchmarking dataset</span>
<span class="n">df_selected_cell</span> <span class="o">=</span> <span class="n">benchdb</span><span class="o">.</span><span class="n">load_benchmark_dataset</span><span class="p">(</span>
    <span class="n">dataset_type</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-3-load-the-features-db">
<h2>Step-3: Load the Features DB<a class="headerlink" href="#step-3-load-the-features-db" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Load the features (e.g., <code class="docutils literal notranslate"><span class="pre">log_max_diff_dQ</span></code>, <code class="docutils literal notranslate"><span class="pre">log_max_diff_dV</span></code>) based
on <code class="docutils literal notranslate"><span class="pre">selected_cell_label</span></code> in <code class="docutils literal notranslate"><span class="pre">BenchDB</span></code>.</p></li>
<li><p>To make the chart more informative, bubble sizes are scaled by ratios
calculated from the distributions of feature values (<code class="docutils literal notranslate"><span class="pre">max_diff_dQ</span></code> and
<code class="docutils literal notranslate"><span class="pre">max_diff_dV</span></code>). Using absolute values ensures all sizes are positive.</p></li>
<li><p>Plot the bubble chart using the logarithmic features <code class="docutils literal notranslate"><span class="pre">log_max_diff_dQ</span></code>
and <code class="docutils literal notranslate"><span class="pre">log_max_diff_dV</span></code> as the x and y axes. Bubble sizes are
determined by the calculated ratios. Cycles flagged as outliers are
highlighted via their indices.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the filepath to ``train_features_severson.db``</span>
<span class="c1"># DuckDB instance.</span>
<span class="n">db_features_filepath</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="o">.</span><span class="n">parent</span>
    <span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">,</span><span class="s2">&quot;train_features_severson.db&quot;</span><span class="p">))</span>

<span class="c1"># Load only the training features dataset</span>
<span class="n">df_features_per_cell</span> <span class="o">=</span> <span class="n">benchdb</span><span class="o">.</span><span class="n">load_features_db</span><span class="p">(</span>
    <span class="n">db_features_filepath</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>

<span class="n">unique_cycle_count</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_features_per_cell</span><span class="p">[</span><span class="s2">&quot;cycle_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># Calculate the bubble size ratio for plotting</span>
<span class="n">df_bubble_size_dQ</span> <span class="o">=</span> <span class="n">bstats</span><span class="o">.</span><span class="n">calculate_bubble_size_ratio</span><span class="p">(</span>
    <span class="n">df_variable</span><span class="o">=</span><span class="n">df_features_per_cell</span><span class="p">[</span><span class="s2">&quot;max_diff_dQ&quot;</span><span class="p">])</span>

<span class="n">df_bubble_size_dV</span> <span class="o">=</span> <span class="n">bstats</span><span class="o">.</span><span class="n">calculate_bubble_size_ratio</span><span class="p">(</span>
    <span class="n">df_variable</span><span class="o">=</span><span class="n">df_features_per_cell</span><span class="p">[</span><span class="s2">&quot;max_diff_dV&quot;</span><span class="p">])</span>

<span class="n">bubble_size</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_bubble_size_dV</span><span class="p">)</span>
    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_bubble_size_dQ</span><span class="p">))</span>

<span class="c1"># Plot the bubble chart and label the outliers</span>
<span class="n">axplot</span> <span class="o">=</span> <span class="n">bviz</span><span class="o">.</span><span class="n">plot_bubble_chart</span><span class="p">(</span>
    <span class="n">xseries</span><span class="o">=</span><span class="n">df_features_per_cell</span><span class="p">[</span><span class="s2">&quot;log_max_diff_dQ&quot;</span><span class="p">],</span>
    <span class="n">yseries</span><span class="o">=</span><span class="n">df_features_per_cell</span><span class="p">[</span><span class="s2">&quot;log_max_diff_dV&quot;</span><span class="p">],</span>
    <span class="n">bubble_size</span><span class="o">=</span><span class="n">bubble_size</span><span class="p">,</span>
    <span class="n">unique_cycle_count</span><span class="o">=</span><span class="n">unique_cycle_count</span><span class="p">,</span>
    <span class="n">cycle_outlier_idx_label</span><span class="o">=</span><span class="n">true_outlier_cycle_index</span><span class="p">)</span>

<span class="n">axplot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Cell </span><span class="si">{</span><span class="n">selected_cell_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">axplot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;$\log(\Delta Q_\textrm{scaled,max,cyc)}\;\textrm{[Ah]}$&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">axplot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;$\log(\Delta V_\textrm{scaled,max,cyc})\;\textrm{[V]}$&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">output_fig_filename</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;log_bubble_plot_&quot;</span>
    <span class="o">+</span> <span class="n">selected_cell_label</span>
    <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>

<span class="n">fig_output_path</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">selected_cell_artifacts_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">output_fig_filename</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">fig_output_path</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/log_bubble_plot_2017-05-12_5_4C-70per_3C_CH17.png"><img alt="Bubble plot from ``2017-05-12_5_4C-70per_3C_CH17``" class="align-center" src="_images/log_bubble_plot_2017-05-12_5_4C-70per_3C_CH17.png" style="width: 600px; height: 480px;" />
</a>
</section>
<section id="step-4-train-model-with-tuned-hyperparameters">
<h2>Step-4: Train model with tuned hyperparameters<a class="headerlink" href="#step-4-train-model-with-tuned-hyperparameters" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Resolves PIPELINE_OUTPUT_DIR and reads <code class="docutils literal notranslate"><span class="pre">hyperparams_iforest.csv</span></code> and
filters the CSV to the row for <code class="docutils literal notranslate"><span class="pre">selected_cell_label</span></code>.</p></li>
<li><p>Extracts the hyperparameter dictionary:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">contamination</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_samples</span></code>,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threshold</span></code>.</p></li>
</ul>
</li>
<li><p>Loads the Isolation Forest config from <code class="docutils literal notranslate"><span class="pre">hp.MODEL_CONFIG[&quot;iforest&quot;]</span></code>.</p></li>
<li><p>Builds a ModelRunner with the cell label, feature DataFrame, and
selected features.</p></li>
<li><p>Calls <code class="docutils literal notranslate"><span class="pre">runner.create_model_x_input()</span></code> to get the X matrix
(shape: n_cycles × n_features).</p></li>
<li><p>Instantiates the model with <code class="docutils literal notranslate"><span class="pre">cfg.model_param(param_dict)</span></code>,
fits it, and computes probabilities with predict_proba.</p></li>
<li><p>Converts probabilities into outlier indices and associated outlier scores.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access the global filepath variable PIPELINE_OUTPUT_DIR defined</span>
<span class="c1"># in config.py</span>
<span class="n">PIPELINE_OUTPUT_DIR</span> <span class="o">=</span> <span class="n">bconf</span><span class="o">.</span><span class="n">PIPELINE_OUTPUT_DIR</span>

<span class="c1"># Read hyperparameters from the stored artifacts</span>
<span class="n">hyperparam_filepath</span> <span class="o">=</span>  <span class="n">PIPELINE_OUTPUT_DIR</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span>
    <span class="s2">&quot;hyperparams_iforest.csv&quot;</span><span class="p">)</span>
<span class="n">df_hyperparam_from_csv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">hyperparam_filepath</span><span class="p">)</span>

<span class="c1"># Filter for the selected_cell_label</span>
<span class="n">df_param_per_cell</span> <span class="o">=</span> <span class="n">df_hyperparam_from_csv</span><span class="p">[</span>
    <span class="n">df_hyperparam_from_csv</span><span class="p">[</span><span class="s2">&quot;cell_index&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_cell_label</span><span class="p">]</span>

<span class="c1"># Hyperparameters for Isolation Forest</span>
<span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;contamination&quot;</span><span class="p">:</span> <span class="n">df_param_per_cell</span><span class="p">[</span><span class="s2">&quot;contamination&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="n">df_param_per_cell</span><span class="p">[</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;max_samples&quot;</span><span class="p">:</span> <span class="n">df_param_per_cell</span><span class="p">[</span><span class="s2">&quot;max_samples&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">df_param_per_cell</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>


<span class="c1"># Extract the model configuration for Isolation Forest</span>
<span class="c1"># Note: the dict key for Isolation Forest is iforest</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">MODEL_CONFIG</span><span class="p">[</span><span class="s2">&quot;iforest&quot;</span><span class="p">]</span>

<span class="c1"># The two features implemented in this example</span>
<span class="n">selected_feature_cols</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;log_max_diff_dQ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;log_max_diff_dV&quot;</span><span class="p">)</span>

<span class="c1"># Create a ModelRunner instance based on selected_cell_label,</span>
<span class="c1"># df_features_per_cell and</span>
<span class="c1"># selected_feature_cols</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">ModelRunner</span><span class="p">(</span>
    <span class="n">cell_label</span><span class="o">=</span><span class="n">selected_cell_label</span><span class="p">,</span>
    <span class="n">df_input_features</span><span class="o">=</span><span class="n">df_features_per_cell</span><span class="p">,</span>
    <span class="n">selected_feature_cols</span><span class="o">=</span><span class="n">selected_feature_cols</span>
<span class="p">)</span>

<span class="c1"># Create the training input</span>
<span class="n">Xdata</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">create_model_x_input</span><span class="p">()</span>

<span class="c1"># Create the model based on the configured hyperparameters</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model_param</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Fit the model and get probabilistic outliers prediction</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xdata</span><span class="p">)</span>
<span class="n">proba</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">Xdata</span><span class="p">)</span>

<span class="c1"># Get the predicted outlier indices (pred_outlier_indices)</span>
<span class="c1"># pred_outlier_indices correspond to predicted anomalous cycles in the</span>
<span class="c1"># first example</span>
<span class="p">(</span><span class="n">pred_outlier_indices</span><span class="p">,</span>
 <span class="n">pred_outlier_score</span><span class="p">)</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">pred_outlier_indices_from_proba</span><span class="p">(</span>
    <span class="n">proba</span><span class="o">=</span><span class="n">proba</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">],</span>
    <span class="n">outlier_col</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">proba_col</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-5-predict-probabilistic-anomaly-score-map">
<h2>Step-5: Predict Probabilistic Anomaly Score Map<a class="headerlink" href="#step-5-predict-probabilistic-anomaly-score-map" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pred_outlier_indices</span></code> is a list of cycle indices predicted as
anomalous by the Isolation Forest model. Using <code class="docutils literal notranslate"><span class="pre">.isin()</span></code>, we filter the
dataframe to keep only the cycles identified as anomalies.</p></li>
<li><p>A new column, <code class="docutils literal notranslate"><span class="pre">outlier_prob</span></code>, is added to store the outliers probability
computed by the model, making it easy to track how confidently the
algorithm flags each cycle.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runner.predict_anomaly_score_map</span></code> generates a 2D contour map of anomaly
scores (outlier probability).</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter the selected features based on predicted outlier indices</span>
<span class="n">df_outliers_pred</span> <span class="o">=</span> <span class="n">df_features_per_cell</span><span class="p">[</span>
    <span class="n">df_features_per_cell</span><span class="p">[</span><span class="s2">&quot;cycle_index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">pred_outlier_indices</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">df_outliers_pred</span><span class="p">[</span><span class="s2">&quot;outlier_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred_outlier_score</span>

<span class="c1"># Plot the anomaly score map</span>
<span class="n">axplot</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">predict_anomaly_score_map</span><span class="p">(</span>
  <span class="n">selected_model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
  <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Isolation Forest&quot;</span><span class="p">,</span>
  <span class="n">xoutliers</span><span class="o">=</span><span class="n">df_outliers_pred</span><span class="p">[</span><span class="s2">&quot;log_max_diff_dQ&quot;</span><span class="p">],</span>
  <span class="n">youtliers</span><span class="o">=</span><span class="n">df_outliers_pred</span><span class="p">[</span><span class="s2">&quot;log_max_diff_dV&quot;</span><span class="p">],</span>
  <span class="n">pred_outliers_index</span><span class="o">=</span><span class="n">pred_outlier_indices</span><span class="p">,</span>
  <span class="n">threshold</span><span class="o">=</span><span class="n">param_dict</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/isolation_forest_2017-05-12_5_4C-70per_3C_CH17.png"><img alt="Anomaly score map with iForest from ``2017-05-12_5_4C-70per_3C_CH17``" class="align-center" src="_images/isolation_forest_2017-05-12_5_4C-70per_3C_CH17.png" style="width: 600px; height: 450px;" />
</a>
<p>The figure shows the anomaly score map produced by the Isolation Forest model:</p>
<ul class="simple">
<li><p>Background Heatmap:</p>
<ul>
<li><p>Red regions: high anomaly probability (more likely to contain outliers).</p></li>
<li><p>Blue/white regions: low anomaly probability (normal cycles).</p></li>
</ul>
</li>
<li><p>Dashed Black Contour:</p>
<ul>
<li><p>Represents the decision boundary defined by the Isolation Forest
threshold. Points outside are considered anomalies.</p></li>
</ul>
</li>
<li><p>Black Dots:</p>
<ul>
<li><p>Represent the majority of normal cycles (inlier data).</p></li>
</ul>
</li>
<li><p>Yellow Stars with Labels:</p>
<ul>
<li><p>Mark the detected anomalous cycles (0, 40, 147, 148).</p></li>
<li><p>Their positions in the 2D feature space highlight where they deviate from
typical battery behavior.</p></li>
</ul>
</li>
<li><p>Colorbar (right):</p>
<ul>
<li><p>Quantifies anomaly probability (0 = normal, 1 = highly anomalous).</p></li>
</ul>
</li>
<li><p>Annotation Box:</p>
<ul>
<li><p>Summarizes the predicted anomalous cycles.</p></li>
</ul>
</li>
</ul>
<p>Cycles 0 and 40 show unusually high voltage deviations, while 147 and 148
show strong deviations in charge capacity. These anomalies might correspond
to specific battery degradation events, sensor errors, or experimental
disturbances.</p>
</section>
<section id="step-6-model-performance-evaluation">
<h2>Step-6: Model performance evaluation<a class="headerlink" href="#step-6-model-performance-evaluation" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Map predicted outlier indices to the benchmark dataset:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">df_selected_cell</span></code> holds cycle-level records and the ground-truth label
(e.g., <code class="docutils literal notranslate"><span class="pre">outlier</span></code> = 1 for anomalous cycles, else 0).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pred_outlier_indices</span></code> is the list of cycle indices flagged by the
model.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">modval.evaluate_pred_outliers(...)</span></code> returns a tidy DataFrame with:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">cycle_index</span></code>: Cell discharge cycle index</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true_outlier</span></code>: ground truth (0/1).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pred_outlier</span></code>: model prediction (0/1) for the same cycles.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">modval.generate_confusion_matrix(...)</span></code> aggregates counts of:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">Negative</span> <span class="pre">(TN)</span></code>: predicted 0, truth 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span> <span class="pre">Positive</span> <span class="pre">(FP)</span></code>: predicted 1, truth 0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span> <span class="pre">Negative</span> <span class="pre">(FN)</span></code>: predicted 0, truth 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">True</span> <span class="pre">Positive</span> <span class="pre">(TP)</span></code>: predicted 1, truth 1.</p></li>
</ul>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Map the predicted outlier indices</span>
<span class="n">df_eval_outlier</span> <span class="o">=</span> <span class="n">modval</span><span class="o">.</span><span class="n">evaluate_pred_outliers</span><span class="p">(</span>
  <span class="n">df_benchmark</span><span class="o">=</span><span class="n">df_selected_cell</span><span class="p">,</span>
  <span class="n">outlier_cycle_index</span><span class="o">=</span><span class="n">pred_outlier_indices</span><span class="p">)</span>

<span class="c1"># Confusion matrix</span>
<span class="n">axplot</span> <span class="o">=</span> <span class="n">modval</span><span class="o">.</span><span class="n">generate_confusion_matrix</span><span class="p">(</span>
    <span class="n">y_true</span><span class="o">=</span><span class="n">df_eval_outlier</span><span class="p">[</span><span class="s2">&quot;true_outlier&quot;</span><span class="p">],</span>
    <span class="n">y_pred</span><span class="o">=</span><span class="n">df_eval_outlier</span><span class="p">[</span><span class="s2">&quot;pred_outlier&quot;</span><span class="p">])</span>

<span class="n">axplot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Isolation Forest&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">output_fig_filename</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;conf_matrix_iforest_&quot;</span>
    <span class="o">+</span> <span class="n">selected_cell_label</span>
    <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>

<span class="n">fig_output_path</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">selected_cell_artifacts_dir</span>
    <span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">output_fig_filename</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">fig_output_path</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Evaluate model performance</span>
<span class="n">df_current_eval_metrics</span> <span class="o">=</span> <span class="n">modval</span><span class="o">.</span><span class="n">eval_model_performance</span><span class="p">(</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;iforest&quot;</span><span class="p">,</span>
    <span class="n">selected_cell_label</span><span class="o">=</span><span class="n">selected_cell_label</span><span class="p">,</span>
    <span class="n">df_eval_outliers</span><span class="o">=</span><span class="n">df_eval_outlier</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/conf_matrix_iforest_2017-05-12_5_4C-70per_3C_CH17.png"><img alt="Confusion matrix with iForest from ``2017-05-12_5_4C-70per_3C_CH17``" class="align-center" src="_images/conf_matrix_iforest_2017-05-12_5_4C-70per_3C_CH17.png" style="width: 550px; height: 420px;" />
</a>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="autoapi/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="models.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Models Guide</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Mei-Chin Pang
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Example: Benchmarking Isolation Forest with Probabilistic Outliers Prediction</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#step-1-load-libraries">Step-1: Load libraries</a></li>
<li><a class="reference internal" href="#step-2-load-benchmarking-dataset">Step-2: Load Benchmarking Dataset</a></li>
<li><a class="reference internal" href="#step-3-load-the-features-db">Step-3: Load the Features DB</a></li>
<li><a class="reference internal" href="#step-4-train-model-with-tuned-hyperparameters">Step-4: Train model with tuned hyperparameters</a></li>
<li><a class="reference internal" href="#step-5-predict-probabilistic-anomaly-score-map">Step-5: Predict Probabilistic Anomaly Score Map</a></li>
<li><a class="reference internal" href="#step-6-model-performance-evaluation">Step-6: Model performance evaluation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=6efca38a"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>